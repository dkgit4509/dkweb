<script>
  const SHEET_URL = "https://api.sheetbest.com/sheets/7e4985fe-430a-47f0-b328-394bd58af9c7";
  let allMovies = [];

  fetch(SHEET_URL)
    .then(res => res.json())
    .then(data => {
      allMovies = data.filter(item => item.Name);
      populateFilters(allMovies);
      renderMovies(allMovies);
    });

  function populateFilters(data) {
    const genreSet = new Set();
    const platformSet = new Set();

    data.forEach(item => {
      if (item.Genre) {
        item.Genre.split("/").forEach(g => genreSet.add(g.trim()));
      }
      if (item.Platform) {
        item.Platform.split("/").forEach(p => platformSet.add(p.trim()));
      }
    });

    const genreFilter = document.getElementById("genreFilter");
    const platformFilter = document.getElementById("platformFilter");

    genreSet.forEach(genre => {
      const option = document.createElement("option");
      option.value = genre;
      option.textContent = genre;
      genreFilter.appendChild(option);
    });

    platformSet.forEach(platform => {
      const option = document.createElement("option");
      option.value = platform;
      option.textContent = platform;
      platformFilter.appendChild(option);
    });

    genreFilter.addEventListener("change", filterMovies);
    platformFilter.addEventListener("change", filterMovies);
  }

  function filterMovies() {
    const genreVal = document.getElementById("genreFilter").value;
    const platformVal = document.getElementById("platformFilter").value;

    const filtered = allMovies.filter(item => {
      const genres = item.Genre ? item.Genre.split("/").map(g => g.trim()) : [];
      const platforms = item.Platform ? item.Platform.split("/").map(p => p.trim()) : [];

      const genreMatch = genreVal === "" || genres.includes(genreVal);
      const platformMatch = platformVal === "" || platforms.includes(platformVal);

      return genreMatch && platformMatch;
    });

    renderMovies(filtered);
  }

  function renderMovies(data) {
    const container = document.getElementById("showGrid");
    container.innerHTML = "";

    data.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${item.Name}</h3>
        <p>🎭 ${item.Genre}</p>
        <p>📺 ${item.Platform}</p>
        <p class="rating">⭐ ${item.Rating}</p>
      `;
      container.appendChild(card);
    });
  }
</script>
